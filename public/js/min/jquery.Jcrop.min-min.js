!function($){$.Jcrop=function(e,t){function n(e){return Math.round(e)+"px"}function o(e){return P.baseClass+"-"+e}function r(){return $.fx.step.hasOwnProperty("backgroundColor")}function i(e){var t=$(e).offset();return[t.left,t.top]}function a(e){return[e.pageX-B[0],e.pageY-B[1]]}function s(e){"object"!=typeof e&&(e={}),P=$.extend(P,e),$.each(["onChange","onSelect","onRelease","onDblClick"],function(e,t){"function"!=typeof P[t]&&(P[t]=function(){})})}function c(e,t,n){if(B=i(Y),pt.setCursor("move"===e?e:e+"-resize"),"move"===e)return pt.activateHandlers(d(t),g,n);var o=lt.getFixed(),r=l(e),a=lt.getCorner(l(r));lt.setPressed(lt.getCorner(r)),lt.setCurrent(a),pt.activateHandlers(u(e,o),g,n)}function u(e,t){return function(n){if(P.aspectRatio)switch(e){case"e":n[1]=t.y+1;break;case"w":n[1]=t.y+1;break;case"n":n[0]=t.x+1;break;case"s":n[0]=t.x+1}else switch(e){case"e":n[1]=t.y2;break;case"w":n[1]=t.y2;break;case"n":n[0]=t.x2;break;case"s":n[0]=t.x2}lt.setCurrent(n),ft.update()}}function d(e){var t=e;return gt.watchKeys(),function(e){lt.moveOffset([e[0]-t[0],e[1]-t[1]]),t=e,ft.update()}}function l(e){switch(e){case"n":return"sw";case"s":return"nw";case"e":return"nw";case"w":return"ne";case"ne":return"sw";case"nw":return"se";case"se":return"nw";case"sw":return"ne"}}function h(e){return function(t){return P.disabled?!1:"move"!==e||P.allowMove?(B=i(Y),ot=!0,c(e,a(t)),t.stopPropagation(),t.preventDefault(),!1):!1}}function f(e,t,n){var o=e.width(),r=e.height();o>t&&t>0&&(o=t,r=t/e.width()*e.height()),r>n&&n>0&&(r=n,o=n/e.height()*e.width()),tt=e.width()/o,nt=e.height()/r,e.width(o).height(r)}function p(e){return{x:e.x*tt,y:e.y*nt,x2:e.x2*tt,y2:e.y2*nt,w:e.w*tt,h:e.h*nt}}function g(){var e=lt.getFixed();e.w>P.minSelect[0]&&e.h>P.minSelect[1]?(ft.enableHandles(),ft.done()):ft.release(),pt.setCursor(P.allowSelect?"crosshair":"default")}function b(e){if(!P.disabled&&P.allowSelect){ot=!0,B=i(Y),ft.disableHandles(),pt.setCursor("crosshair");var t=a(e);return lt.setPressed(t),ft.update(),pt.activateHandlers(w,g,"touch"===e.type.substring(0,5)),gt.watchKeys(),e.stopPropagation(),e.preventDefault(),!1}}function w(e){lt.setCurrent(e),ft.update()}function v(){var e=$("<div></div>").addClass(o("tracker"));return A&&e.css({opacity:0,backgroundColor:"white"}),e}function y(e){X.removeClass().addClass(o("holder")).addClass(e)}function m(e,t){function n(){window.setTimeout(v,l)}var o=e[0]/tt,r=e[1]/nt,i=e[2]/tt,a=e[3]/nt;if(!rt){var s=lt.flipCoords(o,r,i,a),c=lt.getFixed(),u=[c.x,c.y,c.x2,c.y2],d=u,l=P.animationDelay,h=s[0]-u[0],f=s[1]-u[1],p=s[2]-u[2],g=s[3]-u[3],b=0,w=P.swingSpeed;o=d[0],r=d[1],i=d[2],a=d[3],ft.animMode(!0);var v=function(){return function(){b+=(100-b)/w,d[0]=Math.round(o+b/100*h),d[1]=Math.round(r+b/100*f),d[2]=Math.round(i+b/100*p),d[3]=Math.round(a+b/100*g),b>=99.8&&(b=100),100>b?(C(d),n()):(ft.done(),ft.animMode(!1),"function"==typeof t&&t.call(bt))}}();n()}}function x(e){C([e[0]/tt,e[1]/nt,e[2]/tt,e[3]/nt]),P.onSelect.call(bt,p(lt.getFixed())),ft.enableHandles()}function C(e){lt.setPressed([e[0],e[1]]),lt.setCurrent([e[2],e[3]]),ft.update()}function S(){return p(lt.getFixed())}function k(){return lt.getFixed()}function z(e){s(e),I()}function M(){P.disabled=!0,ft.disableHandles(),ft.setCursor("default"),pt.setCursor("default")}function O(){P.disabled=!1,I()}function j(){ft.done(),pt.activateHandlers(null,null)}function F(){X.remove(),K.show(),K.css("visibility","visible"),$(e).removeData("Jcrop")}function H(e,t){ft.release(),M();var n=new Image;n.onload=function(){var o=n.width,r=n.height,i=P.boxWidth,a=P.boxHeight;Y.width(o).height(r),Y.attr("src",e),G.attr("src",e),f(Y,i,a),q=Y.width(),L=Y.height(),G.width(q).height(L),st.width(q+2*at).height(L+2*at),X.width(q).height(L),ht.resize(q,L),O(),"function"==typeof t&&t.call(bt)},n.src=e}function D(e,t,n){var o=t||P.bgColor;P.bgFade&&r()&&P.fadeTime&&!n?e.animate({backgroundColor:o},{queue:!1,duration:P.fadeTime}):e.css("backgroundColor",o)}function I(e){P.allowResize?e?ft.enableOnly():ft.enableHandles():ft.disableHandles(),pt.setCursor(P.allowSelect?"crosshair":"default"),ft.setCursor(P.allowMove?"move":"default"),P.hasOwnProperty("trueSize")&&(tt=P.trueSize[0]/q,nt=P.trueSize[1]/L),P.hasOwnProperty("setSelect")&&(x(P.setSelect),ft.done(),delete P.setSelect),ht.refresh(),P.bgColor!=ct&&(D(P.shade?ht.getShades():X,P.shade?P.shadeColor||P.bgColor:P.bgColor),ct=P.bgColor),ut!=P.bgOpacity&&(ut=P.bgOpacity,P.shade?ht.refresh():ft.setBgOpacity(ut)),U=P.maxSize[0]||0,Z=P.maxSize[1]||0,_=P.minSize[0]||0,et=P.minSize[1]||0,P.hasOwnProperty("outerImage")&&(Y.attr("src",P.outerImage),delete P.outerImage),ft.refresh()}var B,P=$.extend({},$.Jcrop.defaults),J=navigator.userAgent.toLowerCase(),A=/msie/.test(J),R=/msie [1-6]\./.test(J);"object"!=typeof e&&(e=$(e)[0]),"object"!=typeof t&&(t={}),s(t);var T={border:"none",visibility:"visible",margin:0,padding:0,position:"absolute",top:0,left:0},K=$(e),E=!0;if("IMG"==e.tagName){if(0!=K[0].width&&0!=K[0].height)K.width(K[0].width),K.height(K[0].height);else{var W=new Image;W.src=K[0].src,K.width(W.width),K.height(W.height)}var Y=K.clone().removeAttr("id").css(T).show();Y.width(K.width()),Y.height(K.height()),K.after(Y).hide()}else Y=K.css(T).show(),E=!1,null===P.shade&&(P.shade=!0);f(Y,P.boxWidth,P.boxHeight);var q=Y.width(),L=Y.height(),X=$("<div />").width(q).height(L).addClass(o("holder")).css({position:"relative",backgroundColor:P.bgColor}).insertAfter(K).append(Y);P.addClass&&X.addClass(P.addClass);var G=$("<div />"),N=$("<div />").width("100%").height("100%").css({zIndex:310,position:"absolute",overflow:"hidden"}),V=$("<div />").width("100%").height("100%").css("zIndex",320),Q=$("<div />").css({position:"absolute",zIndex:600}).dblclick(function(){var e=lt.getFixed();P.onDblClick.call(bt,e)}).insertBefore(Y).append(N,V);E&&(G=$("<img />").attr("src",Y.attr("src")).css(T).width(q).height(L),N.append(G)),R&&Q.css({overflowY:"hidden"});var U,Z,_,et,tt,nt,ot,rt,it,at=P.boundary,st=v().width(q+2*at).height(L+2*at).css({position:"absolute",top:n(-at),left:n(-at),zIndex:290}).mousedown(b),ct=P.bgColor,ut=P.bgOpacity;B=i(Y);var dt=function(){function e(){var e,t={},n=["touchstart","touchmove","touchend"],o=document.createElement("div");try{for(e=0;e<n.length;e++){var r=n[e];r="on"+r;var i=r in o;i||(o.setAttribute(r,"return;"),i="function"==typeof o[r]),t[n[e]]=i}return t.touchstart&&t.touchend&&t.touchmove}catch(a){return!1}}function t(){return P.touchSupport===!0||P.touchSupport===!1?P.touchSupport:e()}return{createDragger:function(e){return function(t){return P.disabled?!1:"move"!==e||P.allowMove?(B=i(Y),ot=!0,c(e,a(dt.cfilter(t)),!0),t.stopPropagation(),t.preventDefault(),!1):!1}},newSelection:function(e){return b(dt.cfilter(e))},cfilter:function(e){return e.pageX=e.originalEvent.changedTouches[0].pageX,e.pageY=e.originalEvent.changedTouches[0].pageY,e},isSupported:e,support:t()}}(),lt=function(){function e(e){e=a(e),p=h=e[0],g=f=e[1]}function t(e){e=a(e),d=e[0]-p,l=e[1]-g,p=e[0],g=e[1]}function n(){return[d,l]}function o(e){var t=e[0],n=e[1];0>h+t&&(t-=t+h),0>f+n&&(n-=n+f),g+n>L&&(n+=L-(g+n)),p+t>q&&(t+=q-(p+t)),h+=t,p+=t,f+=n,g+=n}function r(e){var t=i();switch(e){case"ne":return[t.x2,t.y];case"nw":return[t.x,t.y];case"se":return[t.x2,t.y2];case"sw":return[t.x,t.y2]}}function i(){if(!P.aspectRatio)return c();var e,t,n,o,r=P.aspectRatio,i=P.minSize[0]/tt,a=P.maxSize[0]/tt,d=P.maxSize[1]/nt,l=p-h,b=g-f,w=Math.abs(l),v=Math.abs(b),y=w/v;return 0===a&&(a=10*q),0===d&&(d=10*L),r>y?(t=g,n=v*r,e=0>l?h-n:n+h,0>e?(e=0,o=Math.abs((e-h)/r),t=0>b?f-o:o+f):e>q&&(e=q,o=Math.abs((e-h)/r),t=0>b?f-o:o+f)):(e=p,o=w/r,t=0>b?f-o:f+o,0>t?(t=0,n=Math.abs((t-f)*r),e=0>l?h-n:n+h):t>L&&(t=L,n=Math.abs(t-f)*r,e=0>l?h-n:n+h)),e>h?(i>e-h?e=h+i:e-h>a&&(e=h+a),t=t>f?f+(e-h)/r:f-(e-h)/r):h>e&&(i>h-e?e=h-i:h-e>a&&(e=h-a),t=t>f?f+(h-e)/r:f-(h-e)/r),0>e?(h-=e,e=0):e>q&&(h-=e-q,e=q),0>t?(f-=t,t=0):t>L&&(f-=t-L,t=L),u(s(h,f,e,t))}function a(e){return e[0]<0&&(e[0]=0),e[1]<0&&(e[1]=0),e[0]>q&&(e[0]=q),e[1]>L&&(e[1]=L),[Math.round(e[0]),Math.round(e[1])]}function s(e,t,n,o){var r=e,i=n,a=t,s=o;return e>n&&(r=n,i=e),t>o&&(a=o,s=t),[r,a,i,s]}function c(){var e,t=p-h,n=g-f;return U&&Math.abs(t)>U&&(p=t>0?h+U:h-U),Z&&Math.abs(n)>Z&&(g=n>0?f+Z:f-Z),et/nt&&Math.abs(n)<et/nt&&(g=n>0?f+et/nt:f-et/nt),_/tt&&Math.abs(t)<_/tt&&(p=t>0?h+_/tt:h-_/tt),0>h&&(p-=h,h-=h),0>f&&(g-=f,f-=f),0>p&&(h-=p,p-=p),0>g&&(f-=g,g-=g),p>q&&(e=p-q,h-=e,p-=e),g>L&&(e=g-L,f-=e,g-=e),h>q&&(e=h-L,g-=e,f-=e),f>L&&(e=f-L,g-=e,f-=e),u(s(h,f,p,g))}function u(e){return{x:e[0],y:e[1],x2:e[2],y2:e[3],w:e[2]-e[0],h:e[3]-e[1]}}var d,l,h=0,f=0,p=0,g=0;return{flipCoords:s,setPressed:e,setCurrent:t,getOffset:n,moveOffset:o,getCorner:r,getFixed:i}}(),ht=function(){function e(e,t){f.left.css({height:n(t)}),f.right.css({height:n(t)})}function t(){return o(lt.getFixed())}function o(e){f.top.css({left:n(e.x),width:n(e.w),height:n(e.y)}),f.bottom.css({top:n(e.y2),left:n(e.x),width:n(e.w),height:n(L-e.y2)}),f.right.css({left:n(e.x2),width:n(q-e.x2)}),f.left.css({width:n(e.x)})}function r(){return $("<div />").css({position:"absolute",backgroundColor:P.shadeColor||P.bgColor}).appendTo(h)}function i(){l||(l=!0,h.insertBefore(Y),t(),ft.setBgOpacity(1,0,1),G.hide(),a(P.shadeColor||P.bgColor,1),ft.isAwake()?c(P.bgOpacity,1):c(1,1))}function a(e,t){D(d(),e,t)}function s(){l&&(h.remove(),G.show(),l=!1,ft.isAwake()?ft.setBgOpacity(P.bgOpacity,1,1):(ft.setBgOpacity(1,1,1),ft.disableHandles()),D(X,0,1))}function c(e,t){l&&(P.bgFade&&!t?h.animate({opacity:1-e},{queue:!1,duration:P.fadeTime}):h.css({opacity:1-e}))}function u(){P.shade?i():s(),ft.isAwake()&&c(P.bgOpacity)}function d(){return h.children()}var l=!1,h=$("<div />").css({position:"absolute",zIndex:240,opacity:0}),f={top:r(),left:r().height(L),right:r().height(L),bottom:r()};return{update:t,updateRaw:o,getShades:d,setBgColor:a,enable:i,disable:s,resize:e,refresh:u,opacity:c}}(),ft=function(){function e(e){var t=$("<div />").css({position:"absolute",opacity:P.borderOpacity}).addClass(o(e));return N.append(t),t}function t(e,t){var n=$("<div />").mousedown(h(e)).css({cursor:e+"-resize",position:"absolute",zIndex:t}).addClass("ord-"+e);return dt.support&&n.bind("touchstart.jcrop",dt.createDragger(e)),V.append(n),n}function r(e){var n=P.handleSize,r=t(e,M++).css({opacity:P.handleOpacity}).addClass(o("handle"));return n&&r.width(n).height(n),r}function i(e){return t(e,M++).addClass("jcrop-dragbar")}function a(e){var t;for(t=0;t<e.length;t++)F[e[t]]=i(e[t])}function s(t){var n,o;for(o=0;o<t.length;o++){switch(t[o]){case"n":n="hline";break;case"s":n="hline bottom";break;case"e":n="vline right";break;case"w":n="vline"}O[t[o]]=e(n)}}function c(e){var t;for(t=0;t<e.length;t++)j[e[t]]=r(e[t])}function u(e,t){P.shade||G.css({top:n(-t),left:n(-e)}),Q.css({top:n(t),left:n(e)})}function d(e,t){Q.width(Math.round(e)).height(Math.round(t))}function l(){var e=lt.getFixed();lt.setPressed([e.x,e.y]),lt.setCurrent([e.x2,e.y2]),f()}function f(e){return z?g(e):void 0}function g(e){var t=lt.getFixed();d(t.w,t.h),u(t.x,t.y),P.shade&&ht.updateRaw(t),z||w(),e?P.onSelect.call(bt,p(t)):P.onChange.call(bt,p(t))}function b(e,t,n){(z||t)&&(P.bgFade&&!n?Y.animate({opacity:e},{queue:!1,duration:P.fadeTime}):Y.css("opacity",e))}function w(){Q.show(),P.shade?ht.opacity(ut):b(ut,!0),z=!0}function y(){C(),Q.hide(),P.shade?ht.opacity(1):b(1),z=!1,P.onRelease.call(bt)}function m(){H&&V.show()}function x(){return H=!0,P.allowResize?(V.show(),!0):void 0}function C(){H=!1,V.hide()}function S(e){e?(rt=!0,C()):(rt=!1,x())}function k(){S(!1),l()}var z,M=370,O={},j={},F={},H=!1;P.dragEdges&&$.isArray(P.createDragbars)&&a(P.createDragbars),$.isArray(P.createHandles)&&c(P.createHandles),P.drawBorders&&$.isArray(P.createBorders)&&s(P.createBorders),$(document).bind("touchstart.jcrop-ios",function(e){$(e.currentTarget).hasClass("jcrop-tracker")&&e.stopPropagation()});var D=v().mousedown(h("move")).css({cursor:"move",position:"absolute",zIndex:360});return dt.support&&D.bind("touchstart.jcrop",dt.createDragger("move")),N.append(D),C(),{updateVisible:f,update:g,release:y,refresh:l,isAwake:function(){return z},setCursor:function(e){D.css("cursor",e)},enableHandles:x,enableOnly:function(){H=!0},showHandles:m,disableHandles:C,animMode:S,setBgOpacity:b,done:k}}(),pt=function(){function e(e){st.css({zIndex:450}),e?$(document).bind("touchmove.jcrop",i).bind("touchend.jcrop",s):l&&$(document).bind("mousemove.jcrop",n).bind("mouseup.jcrop",o)}function t(){st.css({zIndex:290}),$(document).unbind(".jcrop")}function n(e){return u(a(e)),!1}function o(e){return e.preventDefault(),e.stopPropagation(),ot&&(ot=!1,d(a(e)),ft.isAwake()&&P.onSelect.call(bt,p(lt.getFixed())),t(),u=function(){},d=function(){}),!1}function r(t,n,o){return ot=!0,u=t,d=n,e(o),!1}function i(e){return u(a(dt.cfilter(e))),!1}function s(e){return o(dt.cfilter(e))}function c(e){st.css("cursor",e)}var u=function(){},d=function(){},l=P.trackDocument;return l||st.mousemove(n).mouseup(o).mouseout(o),Y.before(st),{activateHandlers:r,setCursor:c}}(),gt=function(){function e(){P.keySupport&&(r.show(),r.focus())}function t(){r.hide()}function n(e,t,n){P.allowMove&&(lt.moveOffset([t,n]),ft.updateVisible(!0)),e.preventDefault(),e.stopPropagation()}function o(e){if(e.ctrlKey||e.metaKey)return!0;it=e.shiftKey?!0:!1;var t=it?10:1;switch(e.keyCode){case 37:n(e,-t,0);break;case 39:n(e,t,0);break;case 38:n(e,0,-t);break;case 40:n(e,0,t);break;case 27:P.allowSelect&&ft.release();break;case 9:return!0}return!1}var r=$('<input type="radio" />').css({position:"fixed",left:"-120px",width:"12px"}).addClass("jcrop-keymgr"),i=$("<div />").css({position:"absolute",overflow:"hidden"}).append(r);return P.keySupport&&(r.keydown(o).blur(t),R||!P.fixedSupport?(r.css({position:"absolute",left:"-20px"}),i.append(r).insertBefore(Y)):r.insertBefore(Y)),{watchKeys:e}}();dt.support&&st.bind("touchstart.jcrop",dt.newSelection),V.hide(),I(!0);var bt={setImage:H,animateTo:m,setSelect:x,setOptions:z,tellSelect:S,tellScaled:k,setClass:y,disable:M,enable:O,cancel:j,release:ft.release,destroy:F,focus:gt.watchKeys,getBounds:function(){return[q*tt,L*nt]},getWidgetSize:function(){return[q,L]},getScaleFactor:function(){return[tt,nt]},getOptions:function(){return P},ui:{holder:X,selection:Q}};return A&&X.bind("selectstart",function(){return!1}),K.data("Jcrop",bt),bt},$.fn.Jcrop=function(e,t){var n;return this.each(function(){if($(this).data("Jcrop")){if("api"===e)return $(this).data("Jcrop");$(this).data("Jcrop").setOptions(e)}else"IMG"==this.tagName?$.Jcrop.Loader(this,function(){$(this).css({display:"block",visibility:"hidden"}),n=$.Jcrop(this,e),$.isFunction(t)&&t.call(n)}):($(this).css({display:"block",visibility:"hidden"}),n=$.Jcrop(this,e),$.isFunction(t)&&t.call(n))}),this},$.Jcrop.Loader=function(e,t,n){function o(){i.complete?(r.unbind(".jcloader"),$.isFunction(t)&&t.call(i)):window.setTimeout(o,50)}var r=$(e),i=r[0];r.bind("load.jcloader",o).bind("error.jcloader",function(){r.unbind(".jcloader"),$.isFunction(n)&&n.call(i)}),i.complete&&$.isFunction(t)&&(r.unbind(".jcloader"),t.call(i))},$.Jcrop.defaults={allowSelect:!0,allowMove:!0,allowResize:!0,trackDocument:!0,baseClass:"jcrop",addClass:null,bgColor:"black",bgOpacity:.6,bgFade:!1,borderOpacity:.4,handleOpacity:.5,handleSize:null,aspectRatio:0,keySupport:!0,createHandles:["n","s","e","w","nw","ne","se","sw"],createDragbars:["n","s","e","w"],createBorders:["n","s","e","w"],drawBorders:!0,dragEdges:!0,fixedSupport:!0,touchSupport:null,shade:null,boxWidth:0,boxHeight:0,boundary:2,fadeTime:400,animationDelay:20,swingSpeed:3,minSelect:[0,0],maxSize:[0,0],minSize:[0,0],onChange:function(){},onSelect:function(){},onDblClick:function(){},onRelease:function(){}}}(jQuery);